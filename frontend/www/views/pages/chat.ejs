<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <%- include('../partials/head', { 
    title: 'Zipperoo - 聊天室', 
    description: '與賣家即時溝通，詢問商品資訊'
  }) %>
  <link rel="stylesheet" href="/css/pages/chat.css">
</head>
<body class="chat-page">
  <!-- Navigation -->
  <%- include('../partials/navbar', { user: locals.user }) %>

  <!-- Chat Container -->
  <div class="chat-container">
    <!-- Chat Sidebar -->
    <div class="chat-sidebar" id="chat-sidebar">
      <div class="chat-sidebar-header">
        <h5 class="mb-0">
          <i class="bi bi-chat-dots me-2"></i>聊天室
        </h5>
      </div>
      
      <!-- Search -->
      <div class="chat-search">
        <div class="input-group">
          <span class="input-group-text">
            <i class="bi bi-search"></i>
          </span>
          <input type="text" class="form-control" placeholder="搜尋聊天室..." id="chat-search-input">
        </div>
      </div>

      <!-- Chat Rooms List -->
      <div class="chat-rooms-list" id="chat-rooms-list">
        <div class="loading-container text-center py-4">
          <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">載入中...</span>
          </div>
          <p class="mt-2 mb-0 text-muted small">載入聊天室...</p>
        </div>
      </div>

      <!-- No Rooms Message -->
      <div class="no-rooms-message text-center py-4 d-none" id="no-rooms-message">
        <i class="bi bi-chat-square-text text-muted" style="font-size: 2rem;"></i>
        <p class="mt-2 mb-0 text-muted">尚無聊天室</p>
        <p class="small text-muted">開始與賣家對話吧！</p>
      </div>
    </div>

    <!-- Chat Main -->
    <div class="chat-main" id="chat-main">
      <!-- Mobile Header -->
      <div class="chat-mobile-header d-md-none">
        <span class="chat-title">聊天室</span>
      </div>

      <!-- Welcome Screen -->
      <div class="chat-welcome" id="chat-welcome">
        <div class="welcome-content text-center">
          <i class="bi bi-chat-heart text-primary" style="font-size: 4rem;"></i>
          <h3 class="mt-3 mb-2">歡迎來到 Zipperoo 聊天室</h3>
          <p class="text-muted mb-4">選擇一個聊天室開始對話，或與賣家建立新的聊天室</p>
          
          <!-- Quick Actions -->
          <div class="quick-actions">
            <p class="text-muted small">從商品頁面點擊「聯繫賣家」開始聊天</p>
          </div>
        </div>
      </div>

      <!-- Chat Area -->
      <div class="chat-area d-none" id="chat-area">
        <!-- Chat Header -->
        <div class="chat-header">
          <div class="chat-user-info">
            <div class="user-avatar">
              <i class="bi bi-person-circle"></i>
            </div>
            <div class="user-details">
              <h6 class="mb-0" id="chat-user-name">用戶名稱</h6>
              <small class="text-muted" id="chat-user-status">線上</small>
            </div>
          </div>
          <div class="chat-actions">
            <div class="connection-status me-2" id="connection-status">
              <i class="bi bi-wifi text-success" title="已連接"></i>
            </div>
            <button class="btn btn-sm btn-outline-secondary d-md-none" id="close-chat-btn">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
        </div>

        <!-- Messages Container -->
        <div class="messages-container" id="messages-container">
          <div class="messages-loading text-center py-4 d-none" id="messages-loading">
            <div class="spinner-border spinner-border-sm text-primary" role="status">
              <span class="visually-hidden">載入中...</span>
            </div>
            <p class="mt-2 mb-0 text-muted small">載入訊息...</p>
          </div>
          
          <div class="messages-list" id="messages-list">
            <!-- Messages will be inserted here -->
          </div>
          
          <!-- Typing indicator -->
          <div class="typing-indicator d-none" id="typing-indicator">
            <div class="typing-dots">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <span class="typing-text">對方正在輸入...</span>
          </div>
        </div>

        <!-- Message Input -->
        <div class="message-input-container">
          <div class="message-input-wrapper">
            <div class="input-group">
              <input type="text" class="form-control" placeholder="輸入訊息..." id="message-input" maxlength="1000" autocomplete="off">
              <button class="btn btn-primary" type="button" id="send-message-btn">
                <i class="bi bi-send"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <%- include('../partials/scripts') %>
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script type="module" src="/js/pages/chat.js"></script>
</body>
</html> 