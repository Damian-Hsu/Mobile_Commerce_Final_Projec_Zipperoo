<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <%- include('../partials/head', { 
        title: 'ç®¡ç†å¾Œå° - Zipperoo', 
        description: 'ç³»çµ±ç®¡ç†ã€ç”¨æˆ¶ç®¡ç†å’Œæ•¸æ“šçµ±è¨ˆ'
    }) %>
    <link rel="stylesheet" href="/css/pages/admin-dashboard.css">
</head>
<body>
    <%- include('../partials/navbar', { user: locals.user }) %>
    
    <main class="admin-dashboard-main">
        <div class="admin-container">
            <!-- é é¢æ¨™é¡Œ -->
            <div class="dashboard-header">
                <div class="breadcrumb">
                    <a href="/">é¦–é </a>
                    <span>/</span>
                    <span>ç®¡ç†å¾Œå°</span>
                </div>
                <div class="header-content">
                    <h1 class="header-h1">ç®¡ç†å¾Œå°</h1>
                    <p class="subtitle">ç³»çµ±ç¸½è¦½èˆ‡ç®¡ç†æ§åˆ¶å°</p>
                </div>
            </div>

            <!-- çµ±è¨ˆå¡ç‰‡ -->
            <div class="stats-grid">
                <div class="stat-card users">
                    <div class="stat-icon">
                        <i class="bi bi-people"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-users">-</div>
                        <div class="stat-label">è¨»å†Šç”¨æˆ¶</div>
                    </div>
                </div>
                
                <div class="stat-card products on-shelf">
                    <div class="stat-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="on-shelf-count">-</div>
                        <div class="stat-label">ä¸Šæ¶ä¸­</div>
                    </div>
                </div>
                
                <div class="stat-card products off-shelf">
                    <div class="stat-icon">
                        <i class="bi bi-x-circle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="off-shelf-count">-</div>
                        <div class="stat-label">å·²ä¸‹æ¶</div>
                    </div>
                </div>
                
                <div class="stat-card products out-of-stock">
                    <div class="stat-icon">
                        <i class="bi bi-exclamation-triangle"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="out-of-stock-count">-</div>
                        <div class="stat-label">ç¼ºè²¨</div>
                    </div>
                </div>
                
                <div class="stat-card orders">
                    <div class="stat-icon">
                        <i class="bi bi-receipt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-orders">-</div>
                        <div class="stat-label">è¨‚å–®ç¸½æ•¸</div>
                    </div>
                </div>
                
                <div class="stat-card logs">
                    <div class="stat-icon">
                        <i class="bi bi-journal-text"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="total-logs">-</div>
                        <div class="stat-label">ç³»çµ±æ—¥èªŒ</div>
                    </div>
                </div>
            </div>

            <!-- å¿«æ·ç®¡ç†åŠŸèƒ½ -->
            <div class="quick-actions">
                <h2>å¿«æ·ç®¡ç†</h2>
                <div class="actions-grid">
                    <div class="action-card" onclick="window.adminDashboard?.showSection('users')">
                        <div class="action-icon users">
                            <i class="bi bi-people"></i>
                        </div>
                        <h3>ç”¨æˆ¶ç®¡ç†</h3>
                        <p>æŸ¥çœ‹ã€ç·¨è¼¯ç”¨æˆ¶è³‡è¨Šå’Œæ¬Šé™</p>
                    </div>
                    
                    <div class="action-card" onclick="window.adminDashboard?.showSection('products')">
                        <div class="action-icon products">
                            <i class="bi bi-box"></i>
                        </div>
                        <h3>å•†å“ç®¡ç†</h3>
                        <p>å¯©æ ¸å’Œç®¡ç†å¹³å°å•†å“</p>
                    </div>
                    
                    <div class="action-card" onclick="window.adminDashboard?.showSection('categories')">
                        <div class="action-icon categories">
                            <i class="bi bi-tags"></i>
                        </div>
                        <h3>é¡åˆ¥ç®¡ç†</h3>
                        <p>æ–°å¢ã€ç·¨è¼¯å’Œåˆªé™¤å•†å“é¡åˆ¥</p>
                    </div>
                    
                    <div class="action-card" onclick="window.adminDashboard?.showSection('orders')">
                        <div class="action-icon orders">
                            <i class="bi bi-receipt"></i>
                        </div>
                        <h3>è¨‚å–®ç®¡ç†</h3>
                        <p>è™•ç†é€€æ¬¾å’Œç³¾ç´›è¨‚å–®</p>
                    </div>
                    
                    <div class="action-card" onclick="window.adminDashboard?.showSection('logs')">
                        <div class="action-icon logs">
                            <i class="bi bi-journal-text"></i>
                        </div>
                        <h3>ç³»çµ±æ—¥èªŒ</h3>
                        <p>æŸ¥çœ‹ç³»çµ±æ“ä½œè¨˜éŒ„</p>
                    </div>
                </div>
            </div>

            <!-- æ•¸æ“šç®¡ç†å€å¡Š -->
            <div class="management-sections">
                <!-- ç”¨æˆ¶ç®¡ç† -->
                <div class="section-container" id="users-section">
                    <div class="section-header">
                        <h2>
                            <i class="bi bi-people"></i>
                            ç”¨æˆ¶ç®¡ç†
                        </h2>
                        <div class="section-controls">
                            <button class="btn btn-refresh" onclick="window.adminDashboard?.refreshUsers()">
                                <i class="bi bi-arrow-clockwise"></i>
                                é‡æ–°è¼‰å…¥
                            </button>
                        </div>
                    </div>
                    
                    <div class="data-table-container">
                        <div class="loading-container" id="users-loading">
                            <div class="loading-spinner"></div>
                            <p>è¼‰å…¥ç”¨æˆ¶è³‡æ–™ä¸­...</p>
                        </div>
                        
                        <table class="data-table" id="users-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ç”¨æˆ¶å</th>
                                    <th>å¸³è™Ÿ</th>
                                    <th>ä¿¡ç®±</th>
                                    <th>è§’è‰²</th>
                                    <th>å•†åº—åç¨±</th>
                                    <th>å•†å“æ•¸</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>è¨»å†Šæ™‚é–“</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody">
                                <!-- æ•¸æ“šå°‡ç”±JavaScriptå¡«å…… -->
                            </tbody>
                        </table>
                        
                        <div class="pagination-container" id="users-pagination" style="display: none;">
                            <!-- åˆ†é æ§åˆ¶å°‡ç”±JavaScriptç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- å…¶ä»–ç®¡ç†å€å¡Šæœƒåœ¨éœ€è¦æ™‚å‹•æ…‹è¼‰å…¥ -->
                <div class="section-container" id="products-section" style="display: none;">
                    <!-- å•†å“ç®¡ç†å€å¡Š -->
                </div>

                <div class="section-container" id="categories-section" style="display: none;">
                    <!-- é¡åˆ¥ç®¡ç†å€å¡Š -->
                </div>

                <div class="section-container" id="orders-section" style="display: none;">
                    <!-- è¨‚å–®ç®¡ç†å€å¡Š -->
                </div>

                <div class="section-container" id="logs-section" style="display: none;">
                    <!-- ç³»çµ±æ—¥èªŒå€å¡Š -->
                </div>
            </div>
        </div>
    </main>

    <%- include('../partials/footer') %>
    <%- include('../partials/scripts') %>
    <script>
        // ç­‰å¾… App åˆå§‹åŒ–å®Œæˆå¾Œå†è¼‰å…¥ admin-dashboard
        function loadAdminDashboard() {
            console.log('âš¡ é–‹å§‹è¼‰å…¥ç®¡ç†å¾Œå°æ¨¡çµ„...');
            const script = document.createElement('script');
            script.type = 'module';
            script.src = '/js/pages/admin-dashboard.js';
            script.onload = function() {
                console.log('âœ… ç®¡ç†å¾Œå°æ¨¡çµ„è¼‰å…¥æˆåŠŸ');
            };
            script.onerror = function() {
                console.error('âŒ ç®¡ç†å¾Œå°æ¨¡çµ„è¼‰å…¥å¤±æ•—');
            };
            document.head.appendChild(script);
        }
        
        window.addEventListener('appInitialized', function() {
            console.log('ğŸ“± æ”¶åˆ° appInitialized äº‹ä»¶ï¼Œè¼‰å…¥ç®¡ç†å¾Œå°');
            loadAdminDashboard();
        });
        
        // å¦‚æœ App å·²ç¶“åˆå§‹åŒ–ï¼Œç›´æ¥è¼‰å…¥
        if (window.App && window.App.initialized) {
            console.log('ğŸ“± App å·²åˆå§‹åŒ–ï¼Œç›´æ¥è¼‰å…¥ç®¡ç†å¾Œå°');
            loadAdminDashboard();
        }
        
        // å‚™ç”¨ï¼šå»¶é²è¼‰å…¥
        setTimeout(function() {
            if (!document.querySelector('script[src="/js/pages/admin-dashboard.js"]')) {
                console.log('â° å»¶é²è¼‰å…¥ç®¡ç†å¾Œå°æ¨¡çµ„');
                loadAdminDashboard();
            }
        }, 1000);
    </script>
</body>
</html> 