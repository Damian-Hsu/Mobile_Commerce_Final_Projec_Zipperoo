<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>滾動測試</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        
        .test-container {
            width: 400px;
            height: 300px;
            border: 2px solid #ccc;
            overflow-y: auto;
            padding: 10px;
            margin: 20px 0;
        }
        
        .message {
            padding: 8px;
            margin: 5px 0;
            background: #f0f0f0;
            border-radius: 5px;
        }
        
        .controls {
            margin: 10px 0;
        }
        
        button {
            margin: 5px;
            padding: 8px 16px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .info {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>滾動到底部測試</h1>
    
    <div class="controls">
        <button onclick="addMessage()">添加訊息</button>
        <button onclick="scrollToBottomDirect()">直接滾動到底部</button>
        <button onclick="scrollToBottomSmooth()">平滑滾動到底部</button>
        <button onclick="clearMessages()">清空訊息</button>
        <button onclick="checkScrollPosition()">檢查滾動位置</button>
    </div>
    
    <div class="test-container" id="testContainer">
        <div class="message">初始訊息 1</div>
        <div class="message">初始訊息 2</div>
        <div class="message">初始訊息 3</div>
    </div>
    
    <div class="info" id="scrollInfo">
        滾動資訊將顯示在這裡...
    </div>
    
    <h2>聊天頁面測試</h2>
    <div class="controls">
        <button onclick="testChatScroll()">測試聊天頁面滾動</button>
        <button onclick="openChatPage()">打開聊天頁面</button>
    </div>

    <script>
        let messageCount = 4;
        const container = document.getElementById('testContainer');
        const scrollInfo = document.getElementById('scrollInfo');
        
        function addMessage() {
            const message = document.createElement('div');
            message.className = 'message';
            message.textContent = `新訊息 ${messageCount++}`;
            container.appendChild(message);
            updateScrollInfo();
        }
        
        function scrollToBottomDirect() {
            console.log('=== 直接滾動測試 ===');
            console.log('滾動前:', {
                scrollTop: container.scrollTop,
                scrollHeight: container.scrollHeight,
                clientHeight: container.clientHeight
            });
            
            container.scrollTop = container.scrollHeight;
            
            console.log('滾動後:', {
                scrollTop: container.scrollTop,
                scrollHeight: container.scrollHeight,
                clientHeight: container.clientHeight
            });
            
            updateScrollInfo();
        }
        
        function scrollToBottomSmooth() {
            console.log('=== 平滑滾動測試 ===');
            container.scrollTo({
                top: container.scrollHeight,
                behavior: 'smooth'
            });
            
            setTimeout(() => {
                updateScrollInfo();
            }, 500);
        }
        
        function clearMessages() {
            container.innerHTML = '';
            messageCount = 1;
            updateScrollInfo();
        }
        
        function checkScrollPosition() {
            updateScrollInfo();
        }
        
        function updateScrollInfo() {
            const info = {
                scrollTop: container.scrollTop,
                scrollHeight: container.scrollHeight,
                clientHeight: container.clientHeight,
                maxScrollTop: container.scrollHeight - container.clientHeight,
                isAtBottom: Math.abs(container.scrollHeight - (container.scrollTop + container.clientHeight)) < 5
            };
            
            scrollInfo.innerHTML = `
                <strong>滾動資訊:</strong><br>
                scrollTop: ${info.scrollTop}<br>
                scrollHeight: ${info.scrollHeight}<br>
                clientHeight: ${info.clientHeight}<br>
                maxScrollTop: ${info.maxScrollTop}<br>
                isAtBottom: ${info.isAtBottom}<br>
                差距: ${info.scrollHeight - (info.scrollTop + info.clientHeight)}px
            `;
            
            console.log('Scroll Info:', info);
        }
        
        function testChatScroll() {
            if (window.chatPage && window.chatPage.forceScrollToBottomTest) {
                const result = window.chatPage.forceScrollToBottomTest();
                alert(`聊天頁面滾動測試結果: ${result ? '成功' : '失敗'}`);
            } else {
                alert('聊天頁面未載入或測試方法不可用');
            }
        }
        
        function openChatPage() {
            window.open('/chat', '_blank');
        }
        
        // 初始化顯示
        updateScrollInfo();
        
        // 監聽滾動事件
        container.addEventListener('scroll', () => {
            updateScrollInfo();
        });
    </script>
</body>
</html> 